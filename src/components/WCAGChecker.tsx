// ♿ **WCAGアクセシビリティチェッカーコンポーネント**\n\n'use client';\n\nimport React, { useState, useEffect } from 'react';\nimport { Eye, AlertCircle, CheckCircle, XCircle, Lightbulb, Copy } from 'lucide-react';\nimport { ColorInfo } from '../types/color';\nimport { WCAGResult } from '../types/advanced';\nimport { checkWCAGCompliance, evaluatePaletteWCAG } from '../utils/advancedColorUtils';\n\ninterface WCAGCheckerProps {\n  colors: ColorInfo[];\n  onResultsChange: (results: WCAGResult[]) => void;\n  targetLevel?: 'AA' | 'AAA';\n  showSuggestions?: boolean;\n}\n\n/**\n * ♿ **WCAGアクセシビリティチェッカー**\n * \n * WebアクセシビリティガイドラインWCAG 2.1に基づいた\n * コントラスト比の自動チェックと改善提案を提供します\n * \n * @example\n * <WCAGChecker \n *   colors={paletteColors}\n *   onResultsChange={handleWCAGResults}\n *   targetLevel=\"AA\"\n *   showSuggestions={true}\n * />\n */\nexport default function WCAGChecker({\n  colors,\n  onResultsChange,\n  targetLevel = 'AA',\n  showSuggestions = true\n}: WCAGCheckerProps) {\n  const [results, setResults] = useState<WCAGResult[]>([]);\n  const [selectedPair, setSelectedPair] = useState<WCAGResult | null>(null);\n  const [filterLevel, setFilterLevel] = useState<'all' | 'pass' | 'fail'>('all');\n  const [copied, setCopied] = useState<string | null>(null);\n\n  // 📊 **WCAG評価の実行**\n  useEffect(() => {\n    if (colors.length < 2) {\n      setResults([]);\n      onResultsChange([]);\n      return;\n    }\n\n    const wcagResults = evaluatePaletteWCAG(colors);\n    setResults(wcagResults);\n    onResultsChange(wcagResults);\n  }, [colors, onResultsChange]);\n\n  // 🎯 **レベル別フィルタリング**\n  const filteredResults = results.filter(result => {\n    const isPass = targetLevel === 'AA' \n      ? result.aaLevel.normal \n      : result.aaaLevel.normal;\n    \n    switch (filterLevel) {\n      case 'pass':\n        return isPass;\n      case 'fail':\n        return !isPass;\n      default:\n        return true;\n    }\n  });\n\n  // 📈 **統計計算**\n  const stats = {\n    total: results.length,\n    aaPass: results.filter(r => r.aaLevel.normal).length,\n    aaaPass: results.filter(r => r.aaaLevel.normal).length,\n    aaLargePass: results.filter(r => r.aaLevel.large).length,\n    aaaLargePass: results.filter(r => r.aaaLevel.large).length\n  };\n\n  // 📋 **クリップボードコピー**\n  const copyToClipboard = async (text: string, label: string) => {\n    try {\n      await navigator.clipboard.writeText(text);\n      setCopied(label);\n      setTimeout(() => setCopied(null), 2000);\n    } catch (error) {\n      console.error('Copy failed:', error);\n    }\n  };\n\n  // 🎨 **コントラスト比レベルのアイコン取得**\n  const getContrastIcon = (result: WCAGResult) => {\n    const isAAPass = result.aaLevel.normal;\n    const isAAAPass = result.aaaLevel.normal;\n    \n    if (isAAAPass) {\n      return <CheckCircle className=\"w-5 h-5 text-green-600\" />;\n    } else if (isAAPass) {\n      return <CheckCircle className=\"w-5 h-5 text-blue-600\" />;\n    } else {\n      return <XCircle className=\"w-5 h-5 text-red-600\" />;\n    }\n  };\n\n  // 🎨 **コントラスト比レベルのテキスト取得**\n  const getContrastText = (result: WCAGResult) => {\n    const isAAPass = result.aaLevel.normal;\n    const isAAAPass = result.aaaLevel.normal;\n    \n    if (isAAAPass) {\n      return { text: 'AAA準拠', color: 'text-green-600' };\n    } else if (isAAPass) {\n      return { text: 'AA準拠', color: 'text-blue-600' };\n    } else {\n      return { text: '不適合', color: 'text-red-600' };\n    }\n  };\n\n  // 🎨 **カラーペア表示コンポーネント**\n  const ColorPairDisplay = ({ result }: { result: WCAGResult }) => {\n    const contrastInfo = getContrastText(result);\n    \n    return (\n      <div \n        className=\"border rounded-lg p-4 cursor-pointer hover:shadow-md transition-shadow\"\n        onClick={() => setSelectedPair(result)}\n      >\n        <div className=\"flex items-center justify-between mb-3\">\n          <div className=\"flex items-center space-x-2\">\n            {getContrastIcon(result)}\n            <span className={`font-medium ${contrastInfo.color}`}>\n              {contrastInfo.text}\n            </span>\n          </div>\n          <span className=\"text-sm font-mono text-gray-600\">\n            {result.contrastRatio.toFixed(2)}:1\n          </span>\n        </div>\n        \n        {/* 🎨 **カラーサンプル** */}\n        <div className=\"grid grid-cols-2 gap-2 mb-3\">\n          <div className=\"relative\">\n            <div \n              className=\"w-full h-12 rounded border-2 border-gray-200 flex items-center justify-center\"\n              style={{ backgroundColor: result.foreground }}\n            >\n              <span \n                className=\"text-xs font-medium px-2\"\n                style={{ color: result.background }}\n              >\n                テキスト\n              </span>\n            </div>\n            <p className=\"text-xs text-center mt-1 text-gray-500\">\n              前景色: {result.foreground}\n            </p>\n          </div>\n          <div className=\"relative\">\n            <div \n              className=\"w-full h-12 rounded border-2 border-gray-200 flex items-center justify-center\"\n              style={{ backgroundColor: result.background }}\n            >\n              <span \n                className=\"text-xs font-medium px-2\"\n                style={{ color: result.foreground }}\n              >\n                テキスト\n              </span>\n            </div>\n            <p className=\"text-xs text-center mt-1 text-gray-500\">\n              背景色: {result.background}\n            </p>\n          </div>\n        </div>\n        \n        {/* 📊 **詳細情報** */}\n        <div className=\"grid grid-cols-2 gap-4 text-xs\">\n          <div>\n            <p className=\"font-medium text-gray-700 mb-1\">通常文字</p>\n            <p className={result.aaLevel.normal ? 'text-green-600' : 'text-red-600'}>\n              AA: {result.aaLevel.normal ? '✓' : '✗'}\n            </p>\n            <p className={result.aaaLevel.normal ? 'text-green-600' : 'text-red-600'}>\n              AAA: {result.aaaLevel.normal ? '✓' : '✗'}\n            </p>\n          </div>\n          <div>\n            <p className=\"font-medium text-gray-700 mb-1\">大文字</p>\n            <p className={result.aaLevel.large ? 'text-green-600' : 'text-red-600'}>\n              AA: {result.aaLevel.large ? '✓' : '✗'}\n            </p>\n            <p className={result.aaaLevel.large ? 'text-green-600' : 'text-red-600'}>\n              AAA: {result.aaaLevel.large ? '✓' : '✗'}\n            </p>\n          </div>\n        </div>\n      </div>\n    );\n  };\n\n  if (colors.length < 2) {\n    return (\n      <div className=\"bg-yellow-50 border border-yellow-200 rounded-lg p-6\">\n        <div className=\"flex items-center\">\n          <AlertCircle className=\"w-5 h-5 text-yellow-600 mr-2\" />\n          <p className=\"text-yellow-800\">\n            WCAGチェックには最低2色必要です。パレットに色を追加してください。\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"bg-white rounded-lg shadow-lg p-6\">\n      {/* 🏷️ **ヘッダー** */}\n      <div className=\"flex items-center justify-between mb-6\">\n        <h3 className=\"text-lg font-semibold text-gray-900 flex items-center\">\n          <Eye className=\"w-5 h-5 mr-2\" />\n          WCAGアクセシビリティチェック\n        </h3>\n        \n        {/* 🎯 **ターゲットレベル選択** */}\n        <div className=\"flex space-x-2\">\n          {(['AA', 'AAA'] as const).map((level) => (\n            <button\n              key={level}\n              onClick={() => setFilterLevel(level === targetLevel && filterLevel !== 'all' ? 'all' : level === 'AA' ? 'pass' : 'pass')}\n              className={`px-3 py-1 rounded text-sm font-medium transition-colors ${\n                targetLevel === level\n                  ? 'bg-blue-100 text-blue-800'\n                  : 'bg-gray-100 text-gray-600 hover:bg-gray-200'\n              }`}\n            >\n              {level}準拠\n            </button>\n          ))}\n        </div>\n      </div>\n\n      {/* 📊 **統計サマリー** */}\n      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6\">\n        <div className=\"bg-gray-50 p-4 rounded-lg\">\n          <p className=\"text-2xl font-bold text-gray-900\">{stats.total}</p>\n          <p className=\"text-sm text-gray-600\">総組み合わせ</p>\n        </div>\n        <div className=\"bg-green-50 p-4 rounded-lg\">\n          <p className=\"text-2xl font-bold text-green-600\">{stats.aaPass}</p>\n          <p className=\"text-sm text-gray-600\">AA準拠（通常）</p>\n        </div>\n        <div className=\"bg-blue-50 p-4 rounded-lg\">\n          <p className=\"text-2xl font-bold text-blue-600\">{stats.aaaPass}</p>\n          <p className=\"text-sm text-gray-600\">AAA準拠（通常）</p>\n        </div>\n        <div className=\"bg-purple-50 p-4 rounded-lg\">\n          <p className=\"text-2xl font-bold text-purple-600\">\n            {Math.round((stats.aaPass / stats.total) * 100)}%\n          </p>\n          <p className=\"text-sm text-gray-600\">AA準拠率</p>\n        </div>\n      </div>\n\n      {/* 🔍 **フィルター** */}\n      <div className=\"flex items-center space-x-4 mb-6\">\n        <span className=\"text-sm font-medium text-gray-700\">表示フィルター:</span>\n        {(['all', 'pass', 'fail'] as const).map((filter) => (\n          <button\n            key={filter}\n            onClick={() => setFilterLevel(filter)}\n            className={`px-3 py-1 rounded text-sm transition-colors ${\n              filterLevel === filter\n                ? 'bg-blue-100 text-blue-800'\n                : 'bg-gray-100 text-gray-600 hover:bg-gray-200'\n            }`}\n          >\n            {filter === 'all' ? 'すべて' : filter === 'pass' ? '合格のみ' : '不合格のみ'}\n          </button>\n        ))}\n      </div>\n\n      {/* 🎨 **カラーペア一覧** */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6\">\n        {filteredResults.map((result, index) => (\n          <ColorPairDisplay key={index} result={result} />\n        ))}\n      </div>\n\n      {/* 💡 **詳細情報パネル** */}\n      {selectedPair && (\n        <div className=\"border-t pt-6\">\n          <div className=\"bg-gray-50 rounded-lg p-6\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <h4 className=\"text-lg font-medium text-gray-900\">詳細情報</h4>\n              <button\n                onClick={() => setSelectedPair(null)}\n                className=\"text-gray-400 hover:text-gray-600\"\n              >\n                ×\n              </button>\n            </div>\n            \n            {/* 🎨 **大きなプレビュー** */}\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6\">\n              <div>\n                <h5 className=\"font-medium text-gray-800 mb-2\">前景色での表示</h5>\n                <div \n                  className=\"w-full p-8 rounded-lg border-2 border-gray-200\"\n                  style={{ backgroundColor: selectedPair.background }}\n                >\n                  <h3 \n                    className=\"text-xl font-bold mb-2\"\n                    style={{ color: selectedPair.foreground }}\n                  >\n                    見出しテキスト\n                  </h3>\n                  <p \n                    className=\"mb-2\"\n                    style={{ color: selectedPair.foreground }}\n                  >\n                    通常のテキストです。このテキストが読みやすいかどうかを確認してください。\n                  </p>\n                  <p \n                    className=\"text-sm\"\n                    style={{ color: selectedPair.foreground }}\n                  >\n                    小さなテキストも確認対象です。\n                  </p>\n                </div>\n              </div>\n              \n              <div>\n                <h5 className=\"font-medium text-gray-800 mb-2\">背景色での表示</h5>\n                <div \n                  className=\"w-full p-8 rounded-lg border-2 border-gray-200\"\n                  style={{ backgroundColor: selectedPair.foreground }}\n                >\n                  <h3 \n                    className=\"text-xl font-bold mb-2\"\n                    style={{ color: selectedPair.background }}\n                  >\n                    見出しテキスト\n                  </h3>\n                  <p \n                    className=\"mb-2\"\n                    style={{ color: selectedPair.background }}\n                  >\n                    通常のテキストです。このテキストが読みやすいかどうかを確認してください。\n                  </p>\n                  <p \n                    className=\"text-sm\"\n                    style={{ color: selectedPair.background }}\n                  >\n                    小さなテキストも確認対象です。\n                  </p>\n                </div>\n              </div>\n            </div>\n            \n            {/* 📊 **詳細データ** */}\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6\">\n              <div>\n                <h5 className=\"font-medium text-gray-800 mb-3\">コントラスト詳細</h5>\n                <div className=\"space-y-2\">\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-sm text-gray-600\">コントラスト比:</span>\n                    <span className=\"font-mono text-sm\">{selectedPair.contrastRatio.toFixed(2)}:1</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-sm text-gray-600\">前景色:</span>\n                    <div className=\"flex items-center space-x-2\">\n                      <code className=\"text-sm\">{selectedPair.foreground}</code>\n                      <button\n                        onClick={() => copyToClipboard(selectedPair.foreground, 'fg')}\n                        className=\"p-1 hover:bg-gray-200 rounded\"\n                      >\n                        <Copy className=\"w-3 h-3\" />\n                      </button>\n                    </div>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-sm text-gray-600\">背景色:</span>\n                    <div className=\"flex items-center space-x-2\">\n                      <code className=\"text-sm\">{selectedPair.background}</code>\n                      <button\n                        onClick={() => copyToClipboard(selectedPair.background, 'bg')}\n                        className=\"p-1 hover:bg-gray-200 rounded\"\n                      >\n                        <Copy className=\"w-3 h-3\" />\n                      </button>\n                    </div>\n                  </div>\n                </div>\n              </div>\n              \n              <div>\n                <h5 className=\"font-medium text-gray-800 mb-3\">WCAG準拠状況</h5>\n                <div className=\"space-y-2\">\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"text-sm text-gray-600\">AA（通常文字）</span>\n                    <span className={`text-sm font-medium ${selectedPair.aaLevel.normal ? 'text-green-600' : 'text-red-600'}`}>\n                      {selectedPair.aaLevel.normal ? '✓ 合格' : '✗ 不合格'}\n                    </span>\n                  </div>\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"text-sm text-gray-600\">AA（大文字）</span>\n                    <span className={`text-sm font-medium ${selectedPair.aaLevel.large ? 'text-green-600' : 'text-red-600'}`}>\n                      {selectedPair.aaLevel.large ? '✓ 合格' : '✗ 不合格'}\n                    </span>\n                  </div>\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"text-sm text-gray-600\">AAA（通常文字）</span>\n                    <span className={`text-sm font-medium ${selectedPair.aaaLevel.normal ? 'text-green-600' : 'text-red-600'}`}>\n                      {selectedPair.aaaLevel.normal ? '✓ 合格' : '✗ 不合格'}\n                    </span>\n                  </div>\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"text-sm text-gray-600\">AAA（大文字）</span>\n                    <span className={`text-sm font-medium ${selectedPair.aaaLevel.large ? 'text-green-600' : 'text-red-600'}`}>\n                      {selectedPair.aaaLevel.large ? '✓ 合格' : '✗ 不合格'}\n                    </span>\n                  </div>\n                </div>\n              </div>\n            </div>\n            \n            {/* 💡 **改善提案** */}\n            {showSuggestions && selectedPair.suggestions && (\n              <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n                <div className=\"flex items-center mb-3\">\n                  <Lightbulb className=\"w-5 h-5 text-blue-600 mr-2\" />\n                  <h5 className=\"font-medium text-blue-800\">改善提案</h5>\n                </div>\n                \n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div>\n                    <p className=\"text-sm font-medium text-blue-800 mb-2\">明るい版</p>\n                    <div className=\"flex items-center space-x-2\">\n                      <div \n                        className=\"w-8 h-8 rounded border\"\n                        style={{ backgroundColor: selectedPair.suggestions.lightVersion }}\n                      />\n                      <code className=\"text-sm\">{selectedPair.suggestions.lightVersion}</code>\n                      <button\n                        onClick={() => copyToClipboard(selectedPair.suggestions!.lightVersion, 'light')}\n                        className=\"p-1 hover:bg-blue-100 rounded\"\n                      >\n                        <Copy className=\"w-3 h-3\" />\n                      </button>\n                    </div>\n                  </div>\n                  \n                  <div>\n                    <p className=\"text-sm font-medium text-blue-800 mb-2\">暗い版</p>\n                    <div className=\"flex items-center space-x-2\">\n                      <div \n                        className=\"w-8 h-8 rounded border\"\n                        style={{ backgroundColor: selectedPair.suggestions.darkVersion }}\n                      />\n                      <code className=\"text-sm\">{selectedPair.suggestions.darkVersion}</code>\n                      <button\n                        onClick={() => copyToClipboard(selectedPair.suggestions!.darkVersion, 'dark')}\n                        className=\"p-1 hover:bg-blue-100 rounded\"\n                      >\n                        <Copy className=\"w-3 h-3\" />\n                      </button>\n                    </div>\n                  </div>\n                </div>\n                \n                <div className=\"mt-4 p-3 bg-blue-100 rounded\">\n                  <p className=\"text-sm text-blue-800\">\n                    💡 <strong>ヒント:</strong> AA基準には4.5:1以上、AAA基準には7:1以上のコントラスト比が必要です。\n                    大きなテキスト（18pt以上）の場合は、AA基準で3:1以上、AAA基準で4.5:1以上となります。\n                  </p>\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n      \n      {/* 📝 **ガイドライン説明** */}\n      <div className=\"mt-6 p-4 bg-gray-50 rounded-lg\">\n        <h4 className=\"font-medium text-gray-800 mb-2\">WCAG 2.1 ガイドライン</h4>\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-600\">\n          <div>\n            <p className=\"font-medium mb-1\">🎯 AA基準（一般推奨）</p>\n            <ul className=\"space-y-1 ml-4\">\n              <li>• 通常テキスト: 4.5:1以上</li>\n              <li>• 大きなテキスト: 3:1以上</li>\n              <li>• 政府機関サイトの最低基準</li>\n            </ul>\n          </div>\n          <div>\n            <p className=\"font-medium mb-1\">🏆 AAA基準（理想的）</p>\n            <ul className=\"space-y-1 ml-4\">\n              <li>• 通常テキスト: 7:1以上</li>\n              <li>• 大きなテキスト: 4.5:1以上</li>\n              <li>• 医療・金融サイト推奨</li>\n            </ul>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}
